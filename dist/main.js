import{createValidator as q}from"check-rule-mate";function x(s,a,c,p,h){let l=q(f(s),{validationHelpers:p,rules:c,schema:a,errorMessages:h,options:{abortEarly:!1,propertiesMustMatch:!1}}),u={onceError:!1};async function g(e){if(!u.onceError||!a[e.target.name])return;let r=f(s);l.setData({...r,[e.target.name]:e.target.value});let t=await l.validateField(e.target.name);m(e.target,t?.errors)}async function E(e){return e.preventDefault(),new Promise(async(r,t)=>{let n=f(s);l.setData(n);let o=await l.validate();o.error?(u.onceError=!0,s.querySelectorAll("input, select, textarea").forEach(i=>{m(i,o?.errors?.[i.name])}),r({...o,formData:n})):o.ok&&r({...o,formData:n}),t({error:!0})})}function b(){s.querySelectorAll("input, select, textarea").forEach(e=>{let r=e.parentElement,t=r.querySelector(".check-rule-mate-error");e.value="",r.classList.remove("field-error"),t&&r.removeChild(t)}),u.onceError=!1}function f(e){let r=e.querySelectorAll("input, textarea, select"),t={};return r.forEach(n=>{let{name:o,type:i,value:d,checked:S}=n;o&&(i==="checkbox"||i==="radio"?S&&(t[o]=d):t[o]=d)}),t}function v(){Object.keys(a).forEach(e=>{c[a[e].rule]?.attributes&&Object.keys(c[a[e].rule]?.attributes).forEach(r=>{if(c[a[e].rule]?.attributes?.[r]){let t=s.querySelector(`input[name=${e}]`);t[r]=c[a[e].rule]?.attributes[r]}}),a[e].attributes&&Object.keys(a[e].attributes).forEach(r=>{if(r==="label"){let t=s.querySelector(`label[for=${e}]`);t.textContent=a[e].attributes[r]}else{let t=s.querySelector(`input[name=${e}]`);t[r]=a[e].attributes[r]}})})}function m(e,r){let t=e.parentElement,n=t.querySelector(".check-rule-mate-error");if(t.classList.add("field-error"),r)if(n)n.textContent=r.message;else{let o=window.document.createElement("span");o.classList.add("check-rule-mate-error"),o.innerHTML=r.message,t.appendChild(o)}else t.classList.remove("field-error"),n&&t.removeChild(n)}return{handleFormSubmit:E,handleFormReset:b,handleInputChange:g,addAttributes:v,getFormData:f}}var D=x;export{D as FormManager};
