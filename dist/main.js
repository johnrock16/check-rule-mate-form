import{createValidator as x}from"check-rule-mate";function D(l,{schema:a,rules:i,validationHelpers:p,errorMessages:g,options:E}){let c=x(u(l),{validationHelpers:p,rules:i,schema:a,errorMessages:g,options:E}),f={onceError:!1};async function b(e){if(!f.onceError||!a[e.target.name])return;let t=u(l);c.setData({...t,[e.target.name]:e.target.value});let r=await c.validateField(e.target.name);d(e.target,r?.errors)}async function v(e){return e.preventDefault(),new Promise(async(t,r)=>{let n=u(l);c.setData(n);let o=await c.validate();o.error?(f.onceError=!0,l.querySelectorAll("input, select, textarea").forEach(s=>{d(s,o?.errors?.[s.name])}),t({...o,formData:n})):o.ok&&t({...o,formData:n}),r({error:!0})})}function h(){l.querySelectorAll("input, select, textarea").forEach(e=>{let t=e.parentElement,r=t.querySelector(".check-rule-mate-error");e.value="",t.classList.remove("field-error"),r&&t.removeChild(r)}),f.onceError=!1}function u(e){let t=e.querySelectorAll("input, textarea, select"),r={};return t.forEach(n=>{let{name:o,type:s,value:m,checked:q}=n;o&&(s==="checkbox"||s==="radio"?q&&(r[o]=m):r[o]=m)}),r}function S(){Object.keys(a).forEach(e=>{i[a[e].rule]?.attributes&&Object.keys(i[a[e].rule]?.attributes).forEach(t=>{if(i[a[e].rule]?.attributes?.[t]){let r=l.querySelector(`input[name=${e}]`);r[t]=i[a[e].rule]?.attributes[t]}}),a[e].attributes&&Object.keys(a[e].attributes).forEach(t=>{if(t==="label"){let r=l.querySelector(`label[for=${e}]`);r.textContent=a[e].attributes[t]}else{let r=l.querySelector(`input[name=${e}]`);r[t]=a[e].attributes[t]}})})}function d(e,t){let r=e.parentElement,n=r.querySelector(".check-rule-mate-error");if(r.classList.add("field-error"),t)if(n)n.textContent=t.message;else{let o=window.document.createElement("span");o.classList.add("check-rule-mate-error"),o.innerHTML=t.message,r.appendChild(o)}else r.classList.remove("field-error"),n&&r.removeChild(n)}return{handleFormSubmit:v,handleFormReset:h,handleInputChange:b,addAttributes:S,getFormData:u}}export{D as FormManager};
